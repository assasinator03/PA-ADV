<%- include('partials/head') %>
<div class="max-w-3xl mx-auto bg-white p-6 rounded shadow">
  <h2 class="text-xl font-semibold mb-2"><%= agent.nom %> <%= agent.prenom %> — <span class="text-sm"><%= agent.matricule %></span></h2>
  <p>Tel: <%= agent.telephone %></p>
  <p>Grade: <%= agent.grade %></p>
  <p>Brigades: <%= agent.brigades.join(', ') %></p>
  <p>Formations: <%= agent.formations.join(', ') %></p>

  <div class="mt-4 flex gap-2">
    <% if (currentUser && (currentUser.role === 'PA' || currentUser.role === 'admin')) { %>
      <a href="/agents/<%= agent.id %>/edit" class="bg-green-600 text-white px-3 py-2 rounded">Modifier</a>
      <form method="post" action="/agents/<%= agent.id %>/delete" onsubmit="return confirm('Supprimer cette fiche ?');">
        <button class="bg-red-600 text-white px-3 py-2 rounded">Supprimer</button>
      </form>
    <% } %>
    <a href="/dashboard" class="px-3 py-2 border rounded">Retour</a>
  </div>

  <section class="mt-6">
    <h3 class="font-semibold">Historique</h3>
    <% if (history.length === 0) { %>
      <p class="text-sm text-gray-600">Aucune modification enregistrée.</p>
    <% } else { %>
      <ul class="space-y-2">
        <% history.forEach(h => { %>
          <li class="p-2 border rounded">
            <div class="text-sm text-gray-700">Par: <%= h.pa_matricule %> (<%= h.pa_nom %>) — <%= new Date(Number(h.date)).toLocaleString() %></div>
            <pre class="text-xs bg-gray-100 p-2 rounded mt-2"><%= h.changes %></pre>
          </li>
        <% }) %>
      </ul>
    <% } %>
  </section>
</div>
<%- include('partials/footer') %>