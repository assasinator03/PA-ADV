
<% layout('layout',{title:'Administration',active:'admin'}) -%>
<h3>Comptes utilisateurs</h3>
<form method="post" action="/admin/users" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;margin-bottom:10px">
  <div><label>Utilisateur</label><input class="form-control" type="text" name="username" required/></div>
  <div>
    <label>Rôle</label>
    <select class="form-select" name="role">
      <option>ADMIN</option>
      <option>PA</option>
      <option>AGENT</option>
    </select>
  </div>
  <div><label>Mot de passe</label><input class="form-control" type="text" name="password" value="changeme" required/></div>
  <div style="display:flex;align-items:flex-end"><button class="btn btn-success" type="submit">Créer</button></div>
</form>

<table class="table">
  <thead><tr><th>Utilisateur</th><th>Rôle</th><th>Doit changer MDP</th><th style="text-align:right">Actions</th></tr></thead>
  <tbody>
  <% users.forEach(u => { %>
    <tr>
      <td><%= u.username %></td>
      <td><%= u.role %></td>
      <td><%= u.mustChangePassword ? 'Oui' : 'Non' %></td>
      <td style="text-align:right">
        <form method="post" action="/admin/users/<%= u.id %>/delete" onsubmit="return confirm('Supprimer ce compte ?')">
          <button class="btn btn-danger">Supprimer</button>
        </form>
      </td>
    </tr>
  <% }) %>
  </tbody>
</table>
